#include	"GREAT.H"

char INTFLG;
struct GEAS my;			/*自機*/
struct GEAS mys[32];	/*自機の弾*/
struct GEAS you[32];	/*敵*/
struct GEAS dan[32];	/*敵の弾*/
int you_p, dan_p;
UBYTE sp_lvl0, sp_lvl1, sp_lvl2, sp_lvl3;	/*プレーンポインタ*/
UBYTE stc_pl0, stc_pl1, stc_pl2, stc_pl3;	/*使用可能プレーン数*/
UBYTE stc_mx0, stc_mx1, stc_mx2, stc_mx3;	/*使用可能プレーン最大数*/
UBYTE pl_tbl[128];							/* プレーン使用状況テーブル */
WORD enemy_tbl[1500];
WORD ppp,pp0,pp1,pp2,pp3,pp4,pp5;
WORD jiki_f;				/*自機のフラグ*/
WORD jiki_xx, jiki_yy;		/*自機座標のダミー値*/
WORD j_stock,j_stock_old;	/*残機数*/
char stick_ptn;
UBYTE jiki_fire,jiki_fire_cnt;
WORD jiki_p;				/*自機キャラパターン*/
WORD speed;					/*自機の移動スピード*/
WORD speed_flg;				/*増加減少フラグ*/
WORD trig_flg;				/*トリガーのフラグ*/
WORD tama_ptn;				/*自機ショットのパターン*/
UBYTE shot_pow,dshot_pow;	/*自機ショットの強さ*/
WORD t_f[12];			/*自機ショットのフラグ*/
WORD tb_f[12];			/*自機ショット爆発のフラグ*/
WORD tb_cnt[12];		/*自機ショット爆発のカウンタ*/
char trig1_flg;			/*トリガー１のフラグ*/
WORD pp[32];			/*敵移動配列のポインタ*/
char pcm0_f,pcm1_f;
UWORD score, old_score;
UBYTE powup00[4863],powup01[2559],atari00[511],atari01[1023];			/* ＰＣＭバッファ */
UBYTE bang00[4095],bang01[4351],bang02[2047],bang03[7167],bang04[2282];
UBYTE gooo1[46847],gooo2[45823],clp[928];
WORD wk0, wk1;

char teki_ft[32];
int teki_xx[32], teki_yy[32];	/*敵座標値*/
WORD teki_dmg[32];			/*敵の固さ*/
WORD teki_bcnt[32];			/*敵の爆発カウンタ*/
int teki_ptn[32];			/*敵のキャラ番号*/
UBYTE teki_pl[32];			/*敵のプレーンNo.*/
UBYTE teki_dsp;				/*出現中の敵数*/
UBYTE teki_num;				/*敵のポインタ*/
WORD teki_wk0[32],teki_wk1[32],teki_wk2[32],teki_wk3[32],teki_wk4[32];
WORD teki_wk5[32][16],teki_wk6[32][16];
UBYTE hmtbl[16][16] = {		/*ホーミングサーチテーブル*/
		{ 0, 1, 1, 1, 1, 1, 1, 1,15,15,15,15,15,15,15,15},
		{ 0, 1, 2, 2, 2, 2, 2, 2, 2, 0, 0, 0, 0, 0, 0, 0},
		{ 1, 1, 2, 3, 3, 3, 3, 3, 3, 3, 1, 1, 1, 1, 1, 1},
		{ 2, 2, 2, 3, 4, 4, 4, 4, 4, 4, 4, 2, 2, 2, 2, 2},
		{ 3, 3, 3, 3, 4, 5, 5, 5, 5, 5, 5, 5, 3, 3, 3, 3},
		{ 4, 4, 4, 4, 4, 5, 6, 6, 6, 6, 6, 6, 6, 4, 4, 4},
		{ 5, 5, 5, 5, 5, 5, 6, 7, 7, 7, 7, 7, 7, 7, 5, 5},
		{ 6, 6, 6, 6, 6, 6, 6, 7, 8, 8, 8, 8, 8, 8, 8, 6},
		{ 7, 7, 7, 7, 7, 7, 7, 7, 8, 9, 9, 9, 9, 9, 9, 9},
		{10, 8, 8, 8, 8, 8, 8, 8, 8, 9,10,10,10,10,10,10},
		{11,11, 9, 9, 9, 9, 9, 9, 9, 9,10,11,11,11,11,11},
		{12,12,12,10,10,10,10,10,10,10,10,11,12,12,12,12},
		{13,13,13,13,11,11,11,11,11,11,11,11,12,13,13,13},
		{14,14,14,14,14,12,12,12,12,12,12,12,12,13,14,14},
		{15,15,15,15,15,15,13,13,13,13,13,13,13,13,14,15},
		{ 0, 0, 0, 0, 0, 0, 0,14,14,14,14,14,14,14,14,15}
};
UWORD hm_ptn[16] = {								/* ホーミングミサイルのパターン */
		0x0b43,0x0b44,0x0b45,0x0b46,
		0x0b47,0x8b46,0x8b45,0x8b44,
		0x8b43,0xcb44,0xcb45,0xcb46,
		0x4b47,0x4b46,0x4b45,0x4b44};
WORD tama_tbl[20] = {								/*ランダムテーブル*/
	 50, 20,100, 80, 50,180, 10,250, 70, 30,
	150, 40, 20,200, 15, 60, 20,130, 20,160};
UWORD bang_ptbl1[20]  = {							/*爆発パターン配列*/
	0x0c56,0x8c56,0x4c56,0xcc56,
	0x0c57,0x8c57,0x4c57,0xcc57,
	0x0c58,0x8c58,0x4c58,0xcc58,
	0x0c59,0x8c59,0x4c59,0xcc59,
	0x0c5a,0x8c5a,0x4c5a,0xcc5a
};
UWORD bang_tbl2[3][12]={
{      0x0100,0x0100,
0x0100,0x0b46,0x0b47,0x0100,
0x0100,0x0b48,0x0b49,0x0100,
       0x0100,0x0100},
{      0x0b4a,0x0b4b,
0x0b4c,0x0b4d,0x0b4e,0x0b4f,
0x8b4c,0x8b4d,0x8b4e,0x8b4f,
       0x8b4a,0x8b4b
},
{      0x0b50,0x0b51,
0x0b52,0x0b53,0x0b54,0x0b55,
0x8b52,0x8b53,0x8b54,0x8b55,
       0x8b50,0x8b51
}};
char bang_x[3][12]={
{   511,511,
511,  0, 16,511,
511,  0, 16,511,
    511,511},
{     0, 16,
-16,  0, 16, 32,
-16,  0, 16, 32,
      0, 16},
{     0, 16,
-16,  0, 16, 32,
-16,  0, 16, 32,
      0, 16}
};
char bang_y[3][12]={
{   511,511,
511,  0,  0,511,
511, 16, 16,511,
    511,511},
{   -16,-16,
  0,  0,  0,  0,
 16, 16, 16, 16,
     32, 32},
{   -16,-16,
  0,  0,  0,  0,
 16, 16, 16, 16,
     32, 32}
};



WORD tama_x[32], tama_y[32], tama_vt[32];
WORD tama_ft[32], tpv[32], tama_atr[32], tama_col;
UBYTE tama_pl[32];
char x_buff[32][300],y_buff[32][300];	/*32方向のバッファ*/
char tama_p;
UBYTE tama_tp,tama_color,tama_color_cnt;
char twk_f,twk_n,kwk_f,kwk_n;
WORD p,main_cnt;

UWORD start_logo_pal[52]={
	0xFFFE,0xf7be,0xEF7E,0xe73e,0xDEFE,0xd6be,0xCE7E,0xc63e,0xBDFE,
	0xb5be,0xa53e,0x94be,0x843e,0x73be,0x633e,0x52be,0x423e,0x31be,
	0x213e,0x003e,0x0038,0x0032,0x002c,0x0026,0x0020,0x001a,0x0014,
	0x001a,0x0020,0x0026,0x002c,0x0032,0x0038,0x003e,0x213e,
	0x31be,0x423e,0x52be,0x633e,0x73be,0x843e,0x94be,0xa53e,0xb5be,
	0xbdfe,0xc63e,0xce7e,0xd6be,0xdefe,0xe73e,0xef7e,0xf7be};
/*
	0xFFFE,0xEF7E,0xDEFE,0xCE7E,0xBDFE,
	0xA53A,0x94BA,0x6B72,0x52AA,0x31A2,0x211C,0x18D4,0x108E,0x0844,
	0x108e,0x18d4,0x211c,0x31a2,0x52aa,0x6b72,
	0x94ba,0xa53a,0xbdfe,0xce7e,0xdefe,0xef7e};
*/


UWORD arm_up[10][50]={
	{0x0200,0x0203,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200},
	{0x0204,0x0206,0x0208,0x020a,0x020c,0x020e,0x0210,0x0212,0x0214,0x0216,0x0262,0x0264,0x0266,0x028c,0x025c,0x025e,0x0294,0x0296,0x0264,0x0266,0x028c,0x025c,0x025e,0x0260,0x0262,0x0264,0x0266,0x028c,0x025c,0x025e,0x0294,0x0296,0x0264,0x0266,0x028c,0x02a4,0x02a6,0x02a8,0x02aa,0x02ac,0x02ae,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200},
	{0x0205,0x0207,0x0209,0x020b,0x020d,0x020f,0x0211,0x0213,0x0215,0x0217,0x0263,0x0265,0x0267,0x028d,0x025d,0x02a0,0x0295,0x0297,0x0265,0x0267,0x028d,0x025d,0x025f,0x0261,0x0263,0x0265,0x0267,0x028d,0x025d,0x02a0,0x0295,0x0297,0x0265,0x0267,0x028d,0x02a5,0x02a7,0x02a9,0x02ab,0x02ad,0x02af,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200},
	{0x0218,0x021a,0x021c,0x021e,0x0220,0x0222,0x0224,0x0226,0x0228,0x022a,0x026e,0x0270,0x0272,0x028e,0x0298,0x029a,0x029c,0x029e,0x0270,0x0272,0x028e,0x0268,0x026a,0x026c,0x026e,0x0270,0x0272,0x028e,0x0298,0x029a,0x029c,0x029e,0x0270,0x0272,0x028e,0x02b0,0x02b2,0x02b4,0x02b6,0x02b8,0x02ba,0x02bc,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200},
	{0x0219,0x021b,0x021d,0x021f,0x0221,0x0223,0x0225,0x0227,0x0229,0x022b,0x026f,0x0271,0x0273,0x028f,0x0299,0x029b,0x029d,0x029f,0x02a1,0x02a2,0x02a3,0x0269,0x026b,0x026d,0x026f,0x0271,0x0273,0x028f,0x0299,0x029b,0x029d,0x029f,0x02a1,0x02a2,0x02a3,0x02b1,0x02b3,0x02b5,0x02b7,0x02b9,0x02bb,0x02bd,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200},
	{0x022c,0x022e,0x0230,0x0232,0x0234,0x0236,0x0238,0x023a,0x023c,0x023e,0x027a,0x027c,0x027e,0x0290,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0274,0x0276,0x0278,0x027a,0x027c,0x027e,0x0290,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x02c0,0x02c2,0x02c4,0x02c6,0x02c8,0x02ca,0x02be,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200},
	{0x022d,0x022f,0x0231,0x0233,0x0235,0x0237,0x0239,0x023b,0x023d,0x023f,0x027b,0x027d,0x027f,0x0291,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0275,0x0277,0x0279,0x027b,0x027d,0x027f,0x0291,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x02c1,0x02c3,0x02c5,0x02c7,0x02c9,0x02cb,0x02bf,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200},
	{0x0240,0x0242,0x0244,0x0246,0x0248,0x024a,0x024c,0x024e,0x0250,0x0252,0x0286,0x0288,0x028a,0x0292,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0280,0x0282,0x0284,0x0286,0x0288,0x028a,0x0292,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x02cc,0x02ce,0x02d0,0x02d2,0x02d4,0x02d5,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200},
	{0x0241,0x0243,0x0245,0x0247,0x0249,0x024b,0x024d,0x024f,0x0251,0x0253,0x0287,0x0289,0x028b,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0281,0x0283,0x0285,0x0287,0x0289,0x028b,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x02cd,0x02cf,0x02d1,0x02d3,0x0200,0x02d9,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200},
	{0x0200,0x0200,0x0200,0x0254,0x0255,0x0256,0x0257,0x0258,0x0259,0x025b,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200,0x0200}};

UWORD arm_down[10][50]={
	{0x8200,0x8200,0x8200,0x8254,0x8255,0x8256,0x8257,0x8258,0x8259,0x825b,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200},
	{0x8241,0x8243,0x8245,0x8247,0x8249,0x824b,0x824d,0x824f,0x8251,0x8253,0x8287,0x8289,0x828b,0x8200,0x8281,0x8283,0x8285,0x8287,0x8289,0x828b,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8281,0x8283,0x8285,0x8287,0x8289,0x828b,0x8200,0x82cd,0x82cf,0x82d1,0x82d3,0x8200,0x82d9,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200},
	{0x8240,0x8242,0x8244,0x8246,0x8248,0x824a,0x824c,0x824e,0x8250,0x8252,0x8286,0x8288,0x828a,0x8292,0x8280,0x8282,0x8284,0x8286,0x8288,0x828a,0x8292,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8280,0x8282,0x8284,0x8286,0x8288,0x828a,0x8292,0x82cc,0x82ce,0x82d0,0x82d2,0x82d4,0x82d5,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200},
	{0x822d,0x822f,0x8231,0x8233,0x8235,0x8237,0x8239,0x823b,0x823d,0x823f,0x827b,0x827d,0x827f,0x8291,0x8275,0x8277,0x8279,0x827b,0x827d,0x827f,0x8291,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8275,0x8277,0x8279,0x827b,0x827d,0x827f,0x8291,0x82c1,0x82c3,0x82c5,0x82c7,0x82c9,0x82cb,0x82bf,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200},
	{0x822c,0x822e,0x8230,0x8232,0x8234,0x8236,0x8238,0x823a,0x823c,0x823e,0x827a,0x827c,0x827e,0x8290,0x8274,0x8276,0x8278,0x827a,0x827c,0x827e,0x8290,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8274,0x8276,0x8278,0x827a,0x827c,0x827e,0x8290,0x82c0,0x82c2,0x82c4,0x82c6,0x82c8,0x82ca,0x82be,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200},
	{0x8219,0x821b,0x821d,0x821f,0x8221,0x8223,0x8225,0x8227,0x8229,0x822b,0x826f,0x8271,0x8273,0x828f,0x8269,0x826b,0x826d,0x826f,0x8271,0x8273,0x828f,0x8299,0x829b,0x829d,0x829f,0x82a1,0x82a2,0x82a3,0x8269,0x826b,0x826d,0x826f,0x8271,0x8273,0x828f,0x82b1,0x82b3,0x82b5,0x82b7,0x82b9,0x82bb,0x82bd,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200},
	{0x8218,0x821a,0x821c,0x821e,0x8220,0x8222,0x8224,0x8226,0x8228,0x822a,0x826e,0x8270,0x8272,0x828e,0x8268,0x826a,0x826c,0x826e,0x8270,0x8272,0x828e,0x8298,0x829a,0x829c,0x829e,0x8270,0x8272,0x828e,0x8268,0x826a,0x826c,0x826e,0x8270,0x8272,0x828e,0x82b0,0x82b2,0x82b4,0x82b6,0x82b8,0x82ba,0x82bc,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200},
	{0x8205,0x8207,0x8209,0x820b,0x820d,0x820f,0x8211,0x8213,0x8215,0x8217,0x8263,0x8265,0x8267,0x828d,0x825d,0x825f,0x8261,0x8263,0x8265,0x8267,0x828d,0x825d,0x82a0,0x8295,0x8297,0x8265,0x8267,0x828d,0x825d,0x825f,0x8261,0x8263,0x8265,0x8267,0x828d,0x82a5,0x82a7,0x82a9,0x82ab,0x82ad,0x82af,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200},
	{0x8204,0x8206,0x8208,0x820a,0x820c,0x820e,0x8210,0x8212,0x8214,0x8216,0x8262,0x8264,0x8266,0x828c,0x825c,0x825e,0x8260,0x8262,0x8264,0x8266,0x828c,0x825c,0x825e,0x8294,0x8296,0x8264,0x8266,0x828c,0x825c,0x825e,0x8260,0x8262,0x8264,0x8266,0x828c,0x82a4,0x82a6,0x82a8,0x82aa,0x82ac,0x82ae,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200},
	{0x8200,0x8203,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200,0x8200}};






char cloud_B0[2048],cloud_B1[3072],cloud_B2[2048],cloud_B3[2048];
char cloud_T0[3072],cloud_T1[3584],cloud_T2[3584],cloud_T3[640];
char cloud_BG[12288],ship_body_u[7168],ship_body_d[7168];
WORD bgx,bgx_d;
WORD core_x,core_y;
WORD gp0,gp1,gp2,gp3;
WORD sys_bg_x,sys_bg_x_d,sys_bg0_y,sys_bg1_y,gbs_xx,gbs_yy0,gbs_yy1;
UBYTE boss;
UBYTE start_logo_x[10]={100,116,132,148,164,100,116,132,148,164};
UBYTE start_logo_y[10]={120,120,120,120,120,136,136,136,136,136};
WORD gbs_mov[512];
char x2y2_x[4]={0,0,16,16},x2y2_y[4]={0,16,0,16};
UWORD ship_body_pal[16]={0x0000,0xe6f8,0xd674,0xc5f0,0xb56c,0x9ca6,0x8c22,0x735c,0x62d8,0x41d2,0x210f,0x6fc0,0x0740,0x4d80,0x2c80,0x0001};
char core_ptn[5][256], smoke_ptn[6][256], jiki_ptn[8][256];
WORD body_x,body_y;									/* ＧＢＳ本体中心（コア）座標 */
UWORD hodai_ptn[5]={0x8275,0x8274,0x0273,0x0274,0x0275};	/*  砲台のパターン番号（５方向のみ）*/
char hodai_dir[32]={4,4,4,3,3,3,2,2,2,2,2,1,1,1,0,0,0,0,0,0,1,1,1,2,2,2,3,3,3,4,4,4};
UWORD contena_d_ptn[8]={
	0x0269,0x026a,0x026b,0x026c,
	0x026d,0x026e,0x026f,0x0270};
UWORD contena_u_ptn[8]={
	0x826d,0x826e,0x826f,0x8270,
	0x8269,0x826a,0x826b,0x826c};
char contena_x[8]={-16,0,16,32,-16,0,16,32},contena_y[8]={0,0,0,0,16,16,16,16};
WORD arm_y;
INT jiki_d, muteki_time,jiki_bcnt;



void main( int argc, char *argv[] )
{
	BYTE stage;			/*ステージのフラグ*/
	WORD i,j,k,l;		/*ワーク*/
	FILE *fp;

	asm("
		pea.l	title_mes
		dc.w	$ff09
		addq	#4,sp
	");
	NNPCMON();
	if ( !((fp = fopen( "DIRCT32.DAT", "rb" )) == (FILE*)NULL) ){
		for ( i = 0; i < 32; i++ ){
			fread( &x_buff[i][0], 300, 1, fp );
			fread( &y_buff[i][0], 300, 1, fp );
		}
		fclose( fp );
	} else {
		printf("'DIRCT32.DAT'がありません\n");
		exit( 1 );
	}

	if ( !((fp = fopen( "GBS_MOV.DAT", "rb" )) == (FILE*)NULL) ){
		i = 0;
		while ( fread( &gbs_mov[i], 1, 2, fp ) == 2 ) i++;
		fclose( fp );
	} else {
		printf("'GBS_MOV.DAT'がありません\n");
		exit( 1 );
	}

	pat_load( "JIKI.DAT",  &jiki_ptn[0][0],  8 );
	pat_load( "CORE.DAT",  &core_ptn[0][0],  5 );
	pat_load( "SMOKE.DAT", &smoke_ptn[0][0], 6 );
	pcm_load( "cloud_B0.DAT", cloud_B0, sizeof( cloud_B0 ));
	pcm_load( "cloud_B1.DAT", cloud_B1, sizeof( cloud_B1 ));
	pcm_load( "cloud_B2.DAT", cloud_B2, sizeof( cloud_B2 ));
	pcm_load( "cloud_B3.DAT", cloud_B3, sizeof( cloud_B3 ));
	pcm_load( "cloud_T0.DAT", cloud_T0, sizeof( cloud_T0 ));
	pcm_load( "cloud_T1.DAT", cloud_T1, sizeof( cloud_T1 ));
	pcm_load( "cloud_T2.DAT", cloud_T2, sizeof( cloud_T2 ));
	pcm_load( "cloud_T3.DAT", cloud_T3, sizeof( cloud_T3 ));
	pcm_load( "cloud_BG.DAT", cloud_BG, sizeof( cloud_BG ));
	pcm_load( "SHIP.DAT",     ship_body_u, sizeof( ship_body_u ));
	pcm_load( "GOH1.PCM",     gooo1,       sizeof( gooo1 ));
	pcm_load( "GOH2.PCM",     gooo2,       sizeof( gooo2 ));
	pcm_load( "clp.PCM",      clp,         sizeof( clp ));
	enemy_load( "ENEMY.DAT" );

	k = 7112; l = 0;
	for ( i = 0; i < 128; i++ ){
		for ( j = 0; j < 56; j++ ){
				ship_body_d[l] = ship_body_u[k];
				k++; l++;
		}
		k -= 112;
	}

	asm("
		.include iocscall.mac
		.include  doscall.mac
		iocs		_OS_CUROF		*カ−ソルＯＦＦ
		move.w		#6,d1			*256x256 16色モード
		iocs		_CRTMOD			*screen(0,1,1,1)
		iocs		_G_CLR_ON		*グラフィック画面の初期化
		move.w		#0,d1			*ウィンドウの設定 window(0,0,511,511)
		move.w		#0,d2
		move.w		#511,d3
		move.w		#511,d4
		iocs		_WINDOW
		move.w		#2,-(sp)
		move.w		#14,-(sp)
		dc.w		_CONCTRL
		addq		#4,sp
		move.w		#2,-(sp)
		move.w		#10,-(sp)
		dc.w		_CONCTRL
		addq		#4,sp
		move.w		#18,-(sp)
		dc.w		_CONCTRL
		addq		#2,sp
		iocs		_SP_ON
		iocs		_MS_INIT		*マウス初期化
		iocs		_MS_CUROF		*マウスカーソルＯＦＦ
		clr.l		d1
		iocs		_SKEY_MOD		*ソフトウェアキーボード表示禁止
	");
	spp_load("GREAT.SPP");
	spl_load("GREAT.SPL");
	m_stop(1,2,3,4,5,6,7,8);

/******************************************初期設定******************************************/

	while ( 1 ){
		SP_APSV( 0, 511 ,511, DUMMY, 0 );
		for( i = 0; i < 128; i++ ) SP_APS( i, 511, 511, DUMMY, 0 );
		SP_APSV( 0, 511 ,511, DUMMY, 0 );
		bg_set( 0, 0, 1 );
		bg_set( 1, 1, 1 );
		bg_scroll( 0, 0, 0 );
		bg_scroll( 1, 0, 0 );
		bg_fill( 0, 0x100 );
		bg_fill( 1, 0x100 );
		/*while ( !TRIGGER() ){*/
			if ( ESCSNS() ){
				asm("
					iocs	_OS_CURON	*カーソルＯＮ
					move.w	#16,d1		*768*512モード
					iocs	_CRTMOD
					*moveq	#3,d0		*キーバッファ・クリア
					*move.b	#%000000,d1
					*trap	#15
					dos		_KFLUSH
					moveq.l	#-1,d1
					iocs	_SKEY_MOD	*ソフトウェアキーボード表示許可
				");
				NNPCMOFF();
				printf("未使用メモリ : %8dバイト\n", chkml() );
				printf("メインカウンタは%8dです\n", main_cnt );
				exit( 0 );	/*終了*/
			}
		/*}*/
		speed = 20;				/*自機の移動スピード*/
		shot_pow = 1;			/*自機ショットの強さ*/
		dshot_pow = 1;			/*自機ショットの強さ*/
		jiki_p = 0x010a;		/*自機キャラパターン*/
		tama_ptn = 0x0177;		/*自機ショットのパターン*/
		score = 0;
		if ( argc == 1 ) j_stock = 100;
		else j_stock = (WORD)atoi( argv[1] );	/*残機設定*/
		j_stock_old = j_stock;

/*************************************各ステージ初期設定*************************************/


		jiki_d=3;
		muteki_time=jiki_bcnt=0;
		boss = body_x = body_y = arm_y = 0;
		core_x = (648+80+4-112)<<4;
		core_y = 128<<4;
		vpage( 0 );
		SP_APSV( 0, 511 ,511, DUMMY, 0 );
		for( i = 0; i < 128; i++ ) SP_APS( i, 511, 511, DUMMY, 0 );
		SP_APSV( 0, 511 ,511, DUMMY, 0 );
		bg_set( 0, 0, 1 );
		bg_set( 1, 1, 1 );
		bg_fill( 0, 0x100 );
		bg_fill( 1, 0x100 );
		haikei_put();
		my.id = 1;
		my.xs  = 8;
		my.ys  = 4;
		my.x  = 16;
		my.y  = 128;
		jiki_xx  = my.x*16;
		jiki_yy  = my.y*16;
		jiki_f=speed_flg=0;
		jiki_fire = jiki_fire_cnt = 0;
		sys_bg_x=sys_bg_x_d=sys_bg0_y=sys_bg1_y=0;
		gp0=gp1=gp2=gp3=0;
		main_cnt=teki_dsp=teki_num=tama_p=tama_tp=trig1_flg=tama_color=tama_color_cnt=0;
		tama_col=0x0d00;
		for ( i = 0; i < 12; i++ ){
			t_f[i]=tb_f[i]=tb_cnt[i]=mys[i].id=0;
			mys[i].xs = 4;mys[i].ys = 2;
		}
		for ( i = 0; i < 32; i++ ){
			pp[i]=teki_bcnt[i]=you[i].id=teki_ft[i]=0;
			dan[i].xs=dan[i].ys=1;
			dan[i].id=tama_x[i]=tama_y[i]=tama_vt[i]=tama_ft[i]=tama_pl[i]=tpv[i]=0;
			tama_atr[i] = 0x0000;
		}
		for ( i = 0; i < 128;i++ ) pl_tbl[i] = 255;
		sp_lvl0 = 26;			/*プレーンデータセット*/
		sp_lvl1 = 36;
		sp_lvl2 = 90;
		sp_lvl3 = 110;
		stc_pl0 = stc_mx0 = sp_lvl1 - sp_lvl0;
		stc_pl1 = stc_mx1 = sp_lvl2 - sp_lvl1;
		stc_pl2 = stc_mx2 = sp_lvl3 - sp_lvl2;
		stc_pl3 = stc_mx3 =     128 - sp_lvl3;
		sp_color(1,start_logo_pal[0],14);			/*ＳＴＡＲＴロゴの初期パレット設定*/
		sp_color(2,start_logo_pal[1],14);
		sp_color(3,start_logo_pal[2],14);
		sp_color(4,start_logo_pal[3],14);
		sp_color(5,start_logo_pal[4],14);
		sp_color(6,start_logo_pal[5],14);
		sp_color(7,start_logo_pal[6],14);
		sp_color(8,start_logo_pal[7],14);
		sp_color(9,start_logo_pal[8],14);
		vpage( 15 );
		SAC_COLOR2( 0, &ship_body_pal[0] );
		SAC_COLOR2( 2, &ship_body_pal[0] );
		TPUT( 0+648-112,   0, 111+648-112, 127, &ship_body_u[0] );
		TPUT( 0+648-112, 128, 111+648-112, 255, &ship_body_d[0] );

/***************************************各ステージ開始***************************************/

		p = 0;
		while( boss != 0xff && !ESCSNS() ){
			g_scroll();
			while ( enemy_tbl[p] == main_cnt ){		/*出現時間とカウンタが同じなら発生*/
				teki_set();
				if ( tama_p  > 18 ) tama_p  = 0;
				p += 5;
			}
			if ( pcm0_f & !NNSTAT() ) pcm0_f = 0;
			if ( XF3SNS() ) {i=10000;while(i--);}
			if ( SPCSNS() ) pause();
			if ( OP1SNS() ) j_stock = -1;
			jiki();
			teki();
			tama();
			t_move();
			check();
			main_cnt++;
		}
	}
}
void copykey(){}
void breakkey(){}

asm("
	.data
	.even
yp:		dc.w	2048
		dc.w	2048
title_mes:
	dc.b	' Hyper Picopico System',$0d,$0a
	dc.b	'THUNDER CROSS  -STAGE4-',$0d,$0a
	dc.b	' Ｇreat Ｂattle Ｓhip',$0d,$0a
	dc.b	'(c)1991 DRY by 副委員長',$0d,$0a,0
	.even
");
